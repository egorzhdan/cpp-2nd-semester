Способы работы с I/O, сетевыми картами и другими:

* поллинг – CPU опрашивает устройства на наличие новых событий
(например, USB, но опрашивает не CPU, а контроллер)
* прерывания – устройство само сообщает процессору о новых событиях
Процессор прерывает работу и вызывает обработчик прерываний

В файле `/proc/interrupts` можно увидеть количество прерываний каждого типа.

В момент прерывания ОС может завершить программу, или сохранить состояние всех регистров
и загрузить другую программу.

Ядро ОС выполняет:

* абстракция железа
* изоляция процессов

## Работа с памятью

Процессор преобразует адреса виртуальной памяти в адреса физической.

Один из способов – **страничная адресация**.

Память каждого процесса разбита на блоки по 4 КБ, и каждый из них
замаплен на физическую память. 

ОС только настраивает это через **таблицы страниц**. Это 512-арное дерево
из 3 уровней с элементами по 8 байт каждый. 
ОС записывает в специальный регистр `CR3` указатель на конень дерева.
В каждой ячейке хранятся адреса детей, или null.
На последнем уровне хранятся реальные адреса страниц, куда отображается.

Процессор использует младшие 12 бит для смещения внутри страницы.
Старшие 25 бит не используются. Адрес является знаковым числом.

Используется дерево вместо простого массива из-за того, что в дереве обычно
нет очень многих элементов. Младшие биты адреса – флаги (доступ, исполняемость и другие).

`malloc` и `free` выделают сразу большой кусок пямяти у ОС, а программе
выдают по немногу.

Поэтому иногда при обращении к уже освобожденной памяти не возникает ошибка:
в этой странице могут лежать другие занятые куски, или `free` может не захотеть
возвращать память обратно ОС. 
